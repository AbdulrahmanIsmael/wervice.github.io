<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="fonts/montserrat.css">
    <title>Setup a new account</title>
    <script>

        function openFile(name, mime) {
            location.href = name + "." + mime
        }
    </script>
    <script src="./database.js"></script>
    <script>
        const systemBase = new database();
    </script>
    <link rel="stylesheet" href="styles/inputs.css">
    <script>
        function addaccount() { // Create new account
            var unvalue = document.getElementById('username1').value + " " + document.getElementById('username2').value
            var hashClear = document.getElementById('password').value // Get password
            if (document.getElementById('usepassword').checked == false) {
                var hashClear = '58FCE4CFBAFC7ADD014996ECF7FA0C52837449CAE057D25FB8EEE2A8C6CEFD5D42A0FC1BFA748955223AE5985FA7B41C4B086971EF934925080230AFE3A2F38D'
                systemBase.setItem('whsp://password.config', hashClear)
                systemBase.setItem('whsp://nopassloginsyst', '(yes)|(true)|(enabled)|(active);naillight923482304823094890234809238409234809238409238409234809234j')
            }
            else {
            function sha512(str) { // Encode password
                return crypto.subtle.digest("SHA-512", new TextEncoder("utf-8").encode(str)).then(buf => {
                    return Array.prototype.map.call(new Uint8Array(buf), x => (('00' + x.toString(16)).slice(-2))).join('');
                });
                if (systemBase.getItem("whsp://password.config") == '58FCE4CFBAFC7ADD014996ECF7FA0C52837449CAE057D25FB8EEE2A8C6CEFD5D42A0FC1BFA748955223AE5985FA7B41C4B086971EF934925080230AFE3A2F38D') {
                    alert('This password is not allowed')
                    localStorage.clear()
                    sessionStorage.clear()
                    location.reload()
                }
            }

            sha512(hashClear).then(x => systemBase.setItem("whsp://password.config", x)) // Set password
            }
            systemBase.setItem("whsp://account", "installed")
            systemBase.setItem("whsp://username.config", unvalue)
            setupFS()
            history.back() // Jump Back
        }

        function setupFS() {
            systemBase.setItem("whsp://quick/backedUp", null)
            systemBase.setItem("whsp://quick/finances", "")
            systemBase.setItem("whsp://quick/importantData", btoa(parseFloat(Math.random()) + parseFloat(Math.random() - Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random()) + parseFloat(Math.random())))
        }

        function ratePassword() {
            var enterdPassword = document.getElementById('password').value
            if (enterdPassword == 'password' || enterdPassword == '123' || enterdPassword == 'Password' || enterdPassword == 'p@ssw0rd' || enterdPassword == 'P@ssw0rd' || enterdPassword == 'MyPassword' || enterdPassword == 'Whitespace') {
                document.getElementById('password').style.backgroundColor = 'red'
                document.getElementById('rater').innerHTML = 'very bad*'

            }

            else {
                if (document.getElementById('password').value.length < 8) {
                    document.getElementById('password').style.backgroundColor = '#ffab8f'
                    document.getElementById('rater').innerHTML = 'Bad*'
                }

                else if (document.getElementById('password').value.length < 12) {
                    document.getElementById('password').style.backgroundColor = '#ffbe3d'
                    document.getElementById('rater').innerHTML = 'Fair*'


                }

                else if (document.getElementById('password').value.length < 20) {
                    document.getElementById('password').style.backgroundColor = '#2cdb5b'
                    document.getElementById('rater').innerHTML = 'Good*'
                }
            }
        }

        function sameasPassword() {
            var passbox1 = document.getElementById('password').value
            var passbox2 = document.getElementById('passwordconfirm').value

            if (passbox1 != passbox2) {
                document.getElementById('confirmShower').innerHTML = 'The password is not the same'
            }
            else if (passbox1 == passbox2) {
                document.getElementById('confirmShower').innerHTML = 'The password is the same'
            }
        }

        function showIt() {
            var checked = document.getElementById('showPassword').checked
            var passbox1 = document.getElementById('password').value
            if (checked) {
                document.getElementById('smallReadBox').innerHTML = passbox1 + "<br>"
            }
            else {
                document.getElementById('smallReadBox').innerHTML = ""
            }
        }
    </script>
    <style>
        body {
            font-family: Montserrat;
            margin: 10px;
        }

        h3 {
            margin-left: 0px;
        }

        div.nav {
            margin: -10px;
            padding: 10px;
            background: dodgerblue;
            color: white;
        }

        div.profile {
            height: 6cm;
            max-height: 50vh;
            width: 12cm;
            max-width: 100vw;
            border-radius: 10px;
            background-color: rgb(84, 189, 230);
            padding: 10px;
            box-shadow: 0px 0px 5px rgb(165, 165, 165);
        }

        input.profile {
            border-width: 0px;
            background-color: rgba(255, 255, 255, 0.534);
            width: 5cm;
            max-width: 50vw;
            font-family: 'Montserrat';
        }
    </style>
    <script src="./systemInfo.js"></script>
    <script>
        if (navigator.userAgent.includes('Mac OS') || navigator.userAgent.includes('iP')) {
                window.canSubtle = true
        }
        else {
                window.canSubtle = false
            }
    </script>
</head>

<body>

    <div id="page" hidden>
        <div class="nav">
            Setup my account
        </div>
        <br>
        <input type="text" name="username" id="username1" placeholder="John">
        <input type="text" name="username" id="username2" placeholder="Doe"><br>
        <input type="password" name="password" id="password" placeholder="password">
        <input type="password" name="password" id="passwordconfirm" placeholder="confirm password"> &ThickSpace; <font style="padding: 8px;background-color: rgb(209, 87, 87);font-size: 10px;border-style: solid;border-width: 1px;border-color: rgb(128, 19, 0);" id="noPasswordTip" hidden>Whitespace does not support password security for your browser.</font><br>
        <div style="margin:10px;">
            <input type="checkbox" name="usepassword" id="usepassword" onchange="document.getElementById('password').disabled = !document.getElementById('password').disabled;document.getElementById('passwordconfirm').disabled = !document.getElementById('passwordconfirm').disabled;" checked>&MediumSpace;<label
                for="usepassword">Enable password security</label>
                 <i title="The password security means, you have to enter a password before starting Whitespace.\nOn iOS and MacOS, you've to disable this, because, iOS and MacOS does not understand the Crypto API.">â„¹</i>
        </div>
        <button style="border-radius:3px;color:black;padding:10px;border-width:0px;margin:10px;" class="eyecatch" onclick="addaccount()">Setup account</button>

        <div style="height:60vh;"></div>
        <hr>
        * This is only a guess. Don't belive on this. Maybe it says your password is secure, but it isn't secure or vize
        versa.
        <noscript style="font-family: sans-serif; font-size: 20px;">
            Please enable JavaScript in this browser. <a href="javascript.png"><img src="javascript.png" alt="JS"
                    height="15"></a>
        </noscript>
        <script>
            if (systemBase.getItem("whsp://account") != null) {
                alert("You can only create one account.")
                location.replace('login.html')
            }
            else {
                document.getElementById('page').hidden = false
            }
        </script>
        <script>
            if (window.canSubtle) {
                document.getElementById('password').disabled = true
                document.getElementById('passwordconfirm').disabled = true
                document.getElementById('usepassword').disabled = true
                document.getElementById('usepassword').checked = false
                document.getElementById('noPasswordTip').hidden = false
            }
        </script>
</body>

</html>